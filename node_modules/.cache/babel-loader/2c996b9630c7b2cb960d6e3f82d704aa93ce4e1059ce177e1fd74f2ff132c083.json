{"ast":null,"code":"/**\r\n * üöÄ INITIALIZATION SCRIPT\r\n * ========================\r\n * Inicializa o sistema unificado de cache offline\r\n * Execute automaticamente ao iniciar o app\r\n */import unifiedStorage from'./unifiedStorage';import syncManager from'./syncManager';import queryManager from'./queryManager';import{auth}from'../firebase';class AppInitializer{constructor(){this.initialized=false;}/**\r\n   * üîß Inicializa o sistema\r\n   */async initialize(){if(this.initialized){console.log('‚úÖ Sistema j√° inicializado');return;}console.log('üöÄ Inicializando sistema offline-first...');try{// 1. Aguarda IndexedDB estar pronto\nawait unifiedStorage.ensureReady();console.log('‚úÖ UnifiedStorage pronto');// 2. Carrega perfil do usu√°rio se autenticado\nconst user=auth.currentUser;if(user){await this.loadUserProfile(user);}// 3. Inicia sincroniza√ß√£o autom√°tica\nsyncManager.startAutoSync();console.log('‚úÖ Auto-sync ativado');// 4. Se estiver online, faz pull inicial\nif(navigator.onLine&&user){console.log('üåê Fazendo pull inicial do Firebase...');await syncManager.pullFromFirebase(user.uid);}this.initialized=true;console.log('üéâ Sistema inicializado com sucesso!');// Log de estat√≠sticas\nconst stats=await unifiedStorage.getStats();console.log('üìä Estat√≠sticas:',stats);}catch(error){console.error('‚ùå Erro ao inicializar sistema:',error);}}/**\r\n   * üë§ Carrega perfil do usu√°rio\r\n   */async loadUserProfile(user){try{// Verifica se j√° tem perfil em cache\nconst cachedProfile=await unifiedStorage.getUserProfile(user.uid);if(!cachedProfile){// Salva perfil do Firebase Auth no cache\nawait unifiedStorage.saveUserProfile({userId:user.uid,username:user.displayName||'Usu√°rio',email:user.email,photoURL:user.photoURL});console.log('‚úÖ Perfil do usu√°rio salvo em cache');}else{console.log('‚úÖ Perfil do usu√°rio carregado do cache');}}catch(error){console.error('‚ùå Erro ao carregar perfil:',error);}}/**\r\n   * üîÑ Reinicializa (√∫til para testes)\r\n   */async reinitialize(){this.initialized=false;await this.initialize();}/**\r\n   * üìä Status do sistema\r\n   */async getStatus(){const stats=await unifiedStorage.getStats();const syncStatus=await syncManager.getStatus();return{initialized:this.initialized,online:navigator.onLine,stats,sync:syncStatus};}}// Singleton\nconst appInitializer=new AppInitializer();// Exp√µe no window para debug\nif(typeof window!=='undefined'){window.appInitializer=appInitializer;console.log('üöÄ AppInitializer dispon√≠vel em window.appInitializer');}export default appInitializer;","map":{"version":3,"names":["unifiedStorage","syncManager","queryManager","auth","AppInitializer","constructor","initialized","initialize","console","log","ensureReady","user","currentUser","loadUserProfile","startAutoSync","navigator","onLine","pullFromFirebase","uid","stats","getStats","error","cachedProfile","getUserProfile","saveUserProfile","userId","username","displayName","email","photoURL","reinitialize","getStatus","syncStatus","online","sync","appInitializer","window"],"sources":["C:/Users/Lucas Araujo/Desktop/supabase/DeckMaster/src/lib/appInitializer.js"],"sourcesContent":["/**\r\n * üöÄ INITIALIZATION SCRIPT\r\n * ========================\r\n * Inicializa o sistema unificado de cache offline\r\n * Execute automaticamente ao iniciar o app\r\n */\r\n\r\nimport unifiedStorage from './unifiedStorage';\r\nimport syncManager from './syncManager';\r\nimport queryManager from './queryManager';\r\nimport { auth } from '../firebase';\r\n\r\nclass AppInitializer {\r\n  constructor() {\r\n    this.initialized = false;\r\n  }\r\n\r\n  /**\r\n   * üîß Inicializa o sistema\r\n   */\r\n  async initialize() {\r\n    if (this.initialized) {\r\n      console.log('‚úÖ Sistema j√° inicializado');\r\n      return;\r\n    }\r\n\r\n    console.log('üöÄ Inicializando sistema offline-first...');\r\n\r\n    try {\r\n      // 1. Aguarda IndexedDB estar pronto\r\n      await unifiedStorage.ensureReady();\r\n      console.log('‚úÖ UnifiedStorage pronto');\r\n\r\n      // 2. Carrega perfil do usu√°rio se autenticado\r\n      const user = auth.currentUser;\r\n      if (user) {\r\n        await this.loadUserProfile(user);\r\n      }\r\n\r\n      // 3. Inicia sincroniza√ß√£o autom√°tica\r\n      syncManager.startAutoSync();\r\n      console.log('‚úÖ Auto-sync ativado');\r\n\r\n      // 4. Se estiver online, faz pull inicial\r\n      if (navigator.onLine && user) {\r\n        console.log('üåê Fazendo pull inicial do Firebase...');\r\n        await syncManager.pullFromFirebase(user.uid);\r\n      }\r\n\r\n      this.initialized = true;\r\n      console.log('üéâ Sistema inicializado com sucesso!');\r\n\r\n      // Log de estat√≠sticas\r\n      const stats = await unifiedStorage.getStats();\r\n      console.log('üìä Estat√≠sticas:', stats);\r\n\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao inicializar sistema:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üë§ Carrega perfil do usu√°rio\r\n   */\r\n  async loadUserProfile(user) {\r\n    try {\r\n      // Verifica se j√° tem perfil em cache\r\n      const cachedProfile = await unifiedStorage.getUserProfile(user.uid);\r\n      \r\n      if (!cachedProfile) {\r\n        // Salva perfil do Firebase Auth no cache\r\n        await unifiedStorage.saveUserProfile({\r\n          userId: user.uid,\r\n          username: user.displayName || 'Usu√°rio',\r\n          email: user.email,\r\n          photoURL: user.photoURL\r\n        });\r\n        console.log('‚úÖ Perfil do usu√°rio salvo em cache');\r\n      } else {\r\n        console.log('‚úÖ Perfil do usu√°rio carregado do cache');\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao carregar perfil:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîÑ Reinicializa (√∫til para testes)\r\n   */\r\n  async reinitialize() {\r\n    this.initialized = false;\r\n    await this.initialize();\r\n  }\r\n\r\n  /**\r\n   * üìä Status do sistema\r\n   */\r\n  async getStatus() {\r\n    const stats = await unifiedStorage.getStats();\r\n    const syncStatus = await syncManager.getStatus();\r\n    \r\n    return {\r\n      initialized: this.initialized,\r\n      online: navigator.onLine,\r\n      stats,\r\n      sync: syncStatus\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton\r\nconst appInitializer = new AppInitializer();\r\n\r\n// Exp√µe no window para debug\r\nif (typeof window !== 'undefined') {\r\n  window.appInitializer = appInitializer;\r\n  console.log('üöÄ AppInitializer dispon√≠vel em window.appInitializer');\r\n}\r\n\r\nexport default appInitializer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}