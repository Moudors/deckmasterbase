{"ast":null,"code":"import React,{useState}from\"react\";import{motion,AnimatePresence}from\"framer-motion\";import{X,ShoppingCart}from\"lucide-react\";import{Button}from\"../ui/button\";import{useAuthState}from\"../../hooks/useAuthState\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BuyRequestModal=_ref=>{var _card$card_faces,_card$card_faces$,_card$card_faces$$ima;let{isOpen,onClose,card,deckOwnerId,deckOwnerName}=_ref;const[user]=useAuthState();const[isSending,setIsSending]=useState(false);const[error,setError]=useState(null);if(!isOpen||!card)return null;const handleSendBuyRequest=async()=>{setIsSending(true);setError(null);try{// Importar operações do Supabase\nconst{messageOperations,userOperations}=await import(\"../../lib/supabaseOperations\");// Buscar display_name do usuário logado\nlet senderName=\"\";try{const userDb=await userOperations.getUser(user.id);senderName=(userDb===null||userDb===void 0?void 0:userDb.display_name)||\"\";}catch(err){console.error('[BUY REQUEST] Erro ao buscar display_name:',err);}// Enviar mensagem de interesse em comprar\nconst messageText=\"\".concat(senderName,\" tem interesse em comprar: \").concat(card.card_name);const messageData={recipient_id:deckOwnerId,sender_id:user===null||user===void 0?void 0:user.id,sender_name:senderName,card_id:card.id,card_name:card.card_name,type:'buy_request',content:messageText,created_at:new Date().toISOString()};await messageOperations.sendMessage(messageData);// Fechar modal\nonClose();}catch(err){console.error('[BUY REQUEST] Erro ao enviar mensagem:',err);setError(\"Erro ao enviar interesse de compra\");}finally{setIsSending(false);}};// Determinar imagem da carta\nconst imageUrl=card.image_url||((_card$card_faces=card.card_faces)===null||_card$card_faces===void 0?void 0:(_card$card_faces$=_card$card_faces[0])===null||_card$card_faces$===void 0?void 0:(_card$card_faces$$ima=_card$card_faces$.image_uris)===null||_card$card_faces$$ima===void 0?void 0:_card$card_faces$$ima.normal);return/*#__PURE__*/_jsx(AnimatePresence,{children:isOpen&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm\",onClick:onClose,children:/*#__PURE__*/_jsxs(motion.div,{initial:{scale:0.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0.9,opacity:0},transition:{type:\"spring\",damping:25,stiffness:300},className:\"bg-gray-900 border border-gray-700 rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(ShoppingCart,{className:\"w-5 h-5 text-blue-500\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-white\",children:\"Interesse em Comprar\"})]}),/*#__PURE__*/_jsx(Button,{variant:\"ghost\",size:\"icon\",onClick:onClose,className:\"text-gray-400 hover:text-white\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 flex justify-center\",children:/*#__PURE__*/_jsx(\"img\",{src:imageUrl,alt:card.card_name,className:\"rounded-lg max-h-64 w-auto shadow-lg\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-white text-center mb-4\",children:card.card_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-lg p-4 mb-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400 mb-2\",children:\"Esta carta pertence a:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 p-2 bg-gray-700 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center\",children:/*#__PURE__*/_jsx(ShoppingCart,{className:\"w-4 h-4 text-blue-500\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white font-medium\",children:deckOwnerName})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-3\",children:\"Uma mensagem ser\\xE1 enviada informando seu interesse em comprar esta carta.\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-3 p-2 bg-red-900/20 border border-red-800 rounded-lg\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-400 text-center\",children:error})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(Button,{onClick:onClose,variant:\"outline\",className:\"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800\",disabled:isSending,children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSendBuyRequest,disabled:isSending,className:\"flex-1 bg-blue-500 hover:bg-blue-600 text-white disabled:opacity-50 disabled:cursor-not-allowed\",children:isSending?\"Enviando...\":\"Enviar Interesse\"})]})]})})});};export default BuyRequestModal;","map":{"version":3,"names":["React","useState","motion","AnimatePresence","X","ShoppingCart","Button","useAuthState","jsx","_jsx","jsxs","_jsxs","BuyRequestModal","_ref","_card$card_faces","_card$card_faces$","_card$card_faces$$ima","isOpen","onClose","card","deckOwnerId","deckOwnerName","user","isSending","setIsSending","error","setError","handleSendBuyRequest","messageOperations","userOperations","senderName","userDb","getUser","id","display_name","err","console","messageText","concat","card_name","messageData","recipient_id","sender_id","sender_name","card_id","type","content","created_at","Date","toISOString","sendMessage","imageUrl","image_url","card_faces","image_uris","normal","children","div","initial","opacity","animate","exit","className","onClick","scale","transition","damping","stiffness","e","stopPropagation","variant","size","src","alt","disabled"],"sources":["C:/Users/Lucas Araujo/Desktop/supabase/DeckMaster/src/components/deck/BuyRequestModal.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { X, ShoppingCart } from \"lucide-react\";\r\nimport { Button } from \"../ui/button\";\r\nimport { useAuthState } from \"../../hooks/useAuthState\";\r\n\r\nconst BuyRequestModal = ({ isOpen, onClose, card, deckOwnerId, deckOwnerName }) => {\r\n  const [user] = useAuthState();\r\n  const [isSending, setIsSending] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  \r\n  if (!isOpen || !card) return null;\r\n\r\n  const handleSendBuyRequest = async () => {\r\n    setIsSending(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Importar operações do Supabase\r\n      const { messageOperations, userOperations } = await import(\"../../lib/supabaseOperations\");\r\n      \r\n      // Buscar display_name do usuário logado\r\n      let senderName = \"\";\r\n      try {\r\n        const userDb = await userOperations.getUser(user.id);\r\n        senderName = userDb?.display_name || \"\";\r\n      } catch (err) {\r\n        console.error('[BUY REQUEST] Erro ao buscar display_name:', err);\r\n      }\r\n      \r\n      // Enviar mensagem de interesse em comprar\r\n      const messageText = `${senderName} tem interesse em comprar: ${card.card_name}`;\r\n      const messageData = {\r\n        recipient_id: deckOwnerId,\r\n        sender_id: user?.id,\r\n        sender_name: senderName,\r\n        card_id: card.id,\r\n        card_name: card.card_name,\r\n        type: 'buy_request',\r\n        content: messageText,\r\n        created_at: new Date().toISOString()\r\n      };\r\n      \r\n      await messageOperations.sendMessage(messageData);\r\n      \r\n      // Fechar modal\r\n      onClose();\r\n    } catch (err) {\r\n      console.error('[BUY REQUEST] Erro ao enviar mensagem:', err);\r\n      setError(\"Erro ao enviar interesse de compra\");\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  };\r\n\r\n  // Determinar imagem da carta\r\n  const imageUrl = card.image_url || card.card_faces?.[0]?.image_uris?.normal;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm\"\r\n          onClick={onClose}\r\n        >\r\n          <motion.div\r\n            initial={{ scale: 0.9, opacity: 0 }}\r\n            animate={{ scale: 1, opacity: 1 }}\r\n            exit={{ scale: 0.9, opacity: 0 }}\r\n            transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\r\n            className=\"bg-gray-900 border border-gray-700 rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <ShoppingCart className=\"w-5 h-5 text-blue-500\" />\r\n                <h2 className=\"text-xl font-bold text-white\">Interesse em Comprar</h2>\r\n              </div>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={onClose}\r\n                className=\"text-gray-400 hover:text-white\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </Button>\r\n            </div>\r\n\r\n            {/* Imagem da carta */}\r\n            <div className=\"mb-4 flex justify-center\">\r\n              <img\r\n                src={imageUrl}\r\n                alt={card.card_name}\r\n                className=\"rounded-lg max-h-64 w-auto shadow-lg\"\r\n              />\r\n            </div>\r\n\r\n            {/* Nome da carta */}\r\n            <h3 className=\"text-lg font-semibold text-white text-center mb-4\">\r\n              {card.card_name}\r\n            </h3>\r\n\r\n            {/* Informação sobre o dono */}\r\n            <div className=\"bg-gray-800 rounded-lg p-4 mb-4\">\r\n              <p className=\"text-sm text-gray-400 mb-2\">\r\n                Esta carta pertence a:\r\n              </p>\r\n              <div className=\"flex items-center gap-2 p-2 bg-gray-700 rounded-lg\">\r\n                <div className=\"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center\">\r\n                  <ShoppingCart className=\"w-4 h-4 text-blue-500\" />\r\n                </div>\r\n                <span className=\"text-white font-medium\">{deckOwnerName}</span>\r\n              </div>\r\n              <p className=\"text-xs text-gray-500 mt-3\">\r\n                Uma mensagem será enviada informando seu interesse em comprar esta carta.\r\n              </p>\r\n            </div>\r\n\r\n            {/* Ações */}\r\n            {error && (\r\n              <div className=\"mb-3 p-2 bg-red-900/20 border border-red-800 rounded-lg\">\r\n                <p className=\"text-sm text-red-400 text-center\">{error}</p>\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3\">\r\n              <Button\r\n                onClick={onClose}\r\n                variant=\"outline\"\r\n                className=\"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800\"\r\n                disabled={isSending}\r\n              >\r\n                Cancelar\r\n              </Button>\r\n              <Button\r\n                onClick={handleSendBuyRequest}\r\n                disabled={isSending}\r\n                className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                {isSending ? \"Enviando...\" : \"Enviar Interesse\"}\r\n              </Button>\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default BuyRequestModal;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}